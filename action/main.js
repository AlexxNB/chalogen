var oe=Object.create,O=Object.defineProperty,se=Object.getPrototypeOf,ue=Object.prototype.hasOwnProperty,ae=Object.getOwnPropertyNames,le=Object.getOwnPropertyDescriptor;var ce=e=>O(e,"__esModule",{value:!0});var F=(e,t)=>()=>(t||(t={exports:{}},e(t.exports,t)),t.exports);var de=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of ae(t))!ue.call(e,r)&&r!=="default"&&O(e,r,{get:()=>t[r],enumerable:!(n=le(t,r))||n.enumerable});return e},S=e=>de(ce(O(e!=null?oe(se(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var w=F(E=>{"use strict";Object.defineProperty(E,"__esModule",{value:!0});function fe(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}E.toCommandValue=fe});var I=F(_=>{"use strict";var pe=_&&_.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(_,"__esModule",{value:!0});var he=pe(require("os")),D=w();function T(e,t,n){let r=new P(e,t,n);process.stdout.write(r.toString()+he.EOL)}_.issueCommand=T;function me(e,t=""){T(e,{},t)}_.issue=me;var B="::",P=class{constructor(t,n,r){t||(t="missing.command"),this.command=t,this.properties=n,this.message=r}toString(){let t=B+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let n=!0;for(let r in this.properties)if(this.properties.hasOwnProperty(r)){let i=this.properties[r];i&&(n?n=!1:t+=",",t+=`${r}=${_e(i)}`)}}return t+=`${B}${ge(this.message)}`,t}};function ge(e){return D.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function _e(e){return D.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var U=F(b=>{"use strict";var q=b&&b.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(b,"__esModule",{value:!0});var M=q(require("fs")),ye=q(require("os")),Fe=w();function be(e,t){let n=process.env[`GITHUB_${e}`];if(!n)throw new Error(`Unable to find environment variable for file command ${e}`);if(!M.existsSync(n))throw new Error(`Missing file at path: ${n}`);M.appendFileSync(n,`${Fe.toCommandValue(t)}${ye.EOL}`,{encoding:"utf8"})}b.issueCommand=be});var Y=F(s=>{"use strict";var we=s&&s.__awaiter||function(e,t,n,r){function i(o){return o instanceof n?o:new n(function(u){u(o)})}return new(n||(n=Promise))(function(o,u){function a(l){try{m(r.next(l))}catch(g){u(g)}}function p(l){try{m(r.throw(l))}catch(g){u(g)}}function m(l){l.done?o(l.value):i(l.value).then(a,p)}m((r=r.apply(e,t||[])).next())})},G=s&&s.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t};Object.defineProperty(s,"__esModule",{value:!0});var f=I(),N=U(),$e=w(),j=G(require("os")),ve=G(require("path")),x;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(x=s.ExitCode||(s.ExitCode={}));function Ce(e,t){let n=$e.toCommandValue(t);if(process.env[e]=n,process.env.GITHUB_ENV||""){let i="_GitHubActionsFileCommandDelimeter_",o=`${e}<<${i}${j.EOL}${n}${j.EOL}${i}`;N.issueCommand("ENV",o)}else f.issueCommand("set-env",{name:e},n)}s.exportVariable=Ce;function Oe(e){f.issueCommand("add-mask",{},e)}s.setSecret=Oe;function Se(e){process.env.GITHUB_PATH||""?N.issueCommand("PATH",e):f.issueCommand("add-path",{},e),process.env.PATH=`${e}${ve.delimiter}${process.env.PATH}`}s.addPath=Se;function Ee(e,t){let n=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!n)throw new Error(`Input required and not supplied: ${e}`);return n.trim()}s.getInput=Ee;function je(e,t){f.issueCommand("set-output",{name:e},t)}s.setOutput=je;function Ae(e){f.issue("echo",e?"on":"off")}s.setCommandEcho=Ae;function Ve(e){process.exitCode=x.Failure,H(e)}s.setFailed=Ve;function ke(){return process.env.RUNNER_DEBUG==="1"}s.isDebug=ke;function De(e){f.issueCommand("debug",{},e)}s.debug=De;function H(e){f.issue("error",e instanceof Error?e.toString():e)}s.error=H;function Pe(e){f.issue("warning",e instanceof Error?e.toString():e)}s.warning=Pe;function Te(e){process.stdout.write(e+j.EOL)}s.info=Te;function R(e){f.issue("group",e)}s.startGroup=R;function L(){f.issue("endgroup")}s.endGroup=L;function Be(e,t){return we(this,void 0,void 0,function*(){R(e);let n;try{n=yield t()}finally{L()}return n})}s.group=Be;function Ie(e,t){f.issueCommand("save-state",{name:e},t)}s.saveState=Ie;function qe(e){return process.env[`STATE_${e}`]||""}s.getState=qe});var re=F(A=>{var Me=Object.create,$=Object.defineProperty,Ue=Object.getPrototypeOf,Ge=Object.prototype.hasOwnProperty,Ne=Object.getOwnPropertyNames,xe=Object.getOwnPropertyDescriptor,z=e=>$(e,"__esModule",{value:!0}),He=(e,t)=>{for(var n in t)$(e,n,{get:t[n],enumerable:!0})},Re=(e,t,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Ne(t))!Ge.call(e,r)&&r!=="default"&&$(e,r,{get:()=>t[r],enumerable:!(n=xe(t,r))||n.enumerable});return e},Le=e=>Re(z($(e!=null?Me(Ue(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);z(A);He(A,{default_options:()=>J,render:()=>Ye});var ze=Le(require("child_process"));function v(e){return e.replace(/\n/g," ").replace(/\s+/g," ").replace(/^\s|\s$/g,"")}function K(e,t){t=t||"%Y-%M-%D";let n=a=>a<10?"0"+a:a,r=new Date(e*1e3),i=r.getFullYear(),o=r.getMonth()+1,u=r.getDate();return t.replace(/%Y/g,i).replace(/%M/g,n(o)).replace(/%D/g,n(u))}var Q={feat:"Features",fix:"Bug Fixes",docs:"Documentation",style:"Styles",refactor:"Code Refactoring",perf:"Performance Improvements",test:"Tests",build:"Builds",ci:"Continuous Integrations",chore:"Chores",revert:"Reverts"};function W(e){return e=="other"?"Other":Q[e]||"Unknown type"}function Je(e){return e.reduce((t,n)=>{let r=n.subject.match(/^(?:(\w+?)(?:\((.*?)\))?:\s*)?(.+)$/),i=r[1]&&Q[r[1]]&&r[1]||"other";return t[i]||(t[i]=[]),t[i].push({...n,subject:r[3],namespace:r[2]||null}),t},{})}function We(e){let t=Ke(),n=Qe(),r={list:{},addVersion(i,o){this.list[i]={date:o||null,commits:[]}},addCommit(i){let o=Object.entries(this.list).sort((u,a)=>u[1].date===null?-1:a[1].date===null?1:a[1].date-u[1].date).reduce((u,[a,p])=>(p.date||Infinity)>=i.date?p:u,null);o&&o.commits.push(i)}};if(r.addVersion("unreleased",null),t.forEach((i,o)=>{let u=i.subject.match(/^(?:v|v\.|v\.\s+)?(\d\.\d\.\d.*)/);u&&(r.addVersion(u[1],i.date),delete t[o])}),n.forEach(i=>{r.addVersion(i.tag,i.date)}),t.forEach(i=>r.addCommit(i)),e)for(let i in r.list)r.list[i].commits=Je(r.list[i].commits);return Object.keys(r.list.unreleased.commits).length==0&&delete r.list.unreleased,r.list}function Ke(){let e=[],t=V("log","--pretty=format:begin:%H:*:%at:*:%an:*:%B:end","--date=raw"),n=/^begin:([\s\S]+?):end$/gm,r;for(;r=n.exec(t);){let i=r[1].split(":*:"),o=i[3].split(`

`);e.push({date:Number(i[1]),hash:i[0],author:i[2],subject:v(o[0]),body:o[1]&&v(o[1])||null,footer:o[2]&&v(o[2])||null,issues:Xe(i[3])})}return e}function Qe(){let e=[],t=V("log","--tags","--simplify-by-decoration",'--pretty="format:begin:%at:*:%D:end"'),n=/^begin:([\s\S]+?):end$/gm,r;for(;r=n.exec(t);){let i=r[1].split(":*:"),o=i[1].match(/tag:\s+(?:v|v\.|v\.\s+)?(\d.+?),/);o&&e.push({date:Number(i[0]),tag:v(o[1])})}return e}function Ze(){let e=V("config","--get","remote.origin.url"),t=e.match(/git@(.+?):(.+?)\/(.+?).git/);return t||(t=e.match(/https?:\/\/(.+?)\/(.+?)\/(.+?)/)),t?{type:t[1].replace(/\..+$/,""),url:"https://"+t[1],owner:t[2],project:t[3]}:null}function X(e,t){return`${e.url}/${e.owner}/${e.project}/issues/${t}`}function Z(e,t){return`${e.url}/${e.owner}/${e.project}/${e.type=="bitbucket"?"commits":"commit"}/${t}`}function V(){return(0,ze.execSync)("git "+Array.from(arguments).join(" ")).toString("utf-8")}function Xe(e){let t=/(?:issues\/(\d+)| #(\d+)|^#(\d+))/g,n=[],r;for(;r=t.exec(e);)n.push(r[1]||r[2]||r[3]);return[...new Set(n)]}var h=(e,t,n)=>`[${t}m${e}[${n}m`,c={blue:e=>h(e,34,39),red:e=>h(e,31,39),green:e=>h(e,32,39),yellow:e=>h(e,33,39),magenta:e=>h(e,35,39),cyan:e=>h(e,36,39),gray:e=>h(e,90,39),bold:e=>h(e,1,22),italic:e=>h(e,3,23),link:(e,t)=>`]8;;${t}\x07${e}]8;;\x07`},et="\u{1F3A8}",tt="\u26A1\uFE0F",rt="\u{1F525}",nt="\u{1F41B}",it="\u{1F691}",ot="\u2728",st="\u{1F4DD}",ut="\u{1F680}",at="\u{1F484}",lt="\u{1F389}",ct="\u2705",dt="\u{1F512}",ft="\u{1F516}",pt="\u{1F6A8}",ht="\u{1F6A7}",mt="\u{1F49A}",gt="\u2B07\uFE0F",_t="\u2B06\uFE0F",yt="\u{1F4CC}",Ft="\u{1F477}",bt="\u{1F4C8}",wt="\u267B\uFE0F",$t="\u2795",vt="\u2796",Ct="\u{1F527}",Ot="\u{1F528}",St="\u{1F310}",Et="\u270F\uFE0F",jt="\u{1F4A9}",At="\u23EA",Vt="\u{1F500}",kt="\u{1F4E6}",Dt="\u{1F47D}",Pt="\u{1F69A}",Tt="\u{1F4C4}",Bt="\u{1F4A5}",It="\u{1F371}",qt="\u267F\uFE0F",Mt="\u{1F4A1}",Ut="\u{1F37B}",Gt="\u{1F4AC}",Nt="\u{1F5C3}",xt="\u{1F50A}",Ht="\u{1F507}",Rt="\u{1F465}",Lt="\u{1F6B8}",Yt="\u{1F3D7}",zt="\u{1F4F1}",Jt="\u{1F921}",Kt="\u{1F95A}",Qt="\u{1F648}",Wt="\u{1F4F8}",Xt="\u2697",Zt="\u{1F50D}",er="\u{1F3F7}\uFE0F",tr="\u{1F331}",rr="\u{1F6A9}",nr="\u{1F945}",ir="\u{1F4AB}",or="\u{1F5D1}",sr="\u{1F6C2}",ur="\u{1FA79}",ar="\u{1F9D0}",lr={":art:":et,":zap:":tt,":fire:":rt,":bug:":nt,":ambulance:":it,":sparkles:":ot,":memo:":st,":rocket:":ut,":lipstick:":at,":tada:":lt,":white_check_mark:":ct,":lock:":dt,":bookmark:":ft,":rotating_light:":pt,":construction:":ht,":green_heart:":mt,":arrow_down:":gt,":arrow_up:":_t,":pushpin:":yt,":construction_worker:":Ft,":chart_with_upwards_trend:":bt,":recycle:":wt,":heavy_plus_sign:":$t,":heavy_minus_sign:":vt,":wrench:":Ct,":hammer:":Ot,":globe_with_meridians:":St,":pencil2:":Et,":poop:":jt,":rewind:":At,":twisted_rightwards_arrows:":Vt,":package:":kt,":alien:":Dt,":truck:":Pt,":page_facing_up:":Tt,":boom:":Bt,":bento:":It,":wheelchair:":qt,":bulb:":Mt,":beers:":Ut,":speech_balloon:":Gt,":card_file_box:":Nt,":loud_sound:":xt,":mute:":Ht,":busts_in_silhouette:":Rt,":children_crossing:":Lt,":building_construction:":Yt,":iphone:":zt,":clown_face:":Jt,":egg:":Kt,":see_no_evil:":Qt,":camera_flash:":Wt,":alembic:":Xt,":mag:":Zt,":label:":er,":seedling:":tr,":triangular_flag_on_post:":rr,":goal_net:":nr,":dizzy:":ir,":wastebasket:":or,":passport_control:":sr,":adhesive_bandage:":ur,":monocle_face:":ar};function C(e){return e.replace(/:\w+?:/g,t=>lr[t]||"")}function cr(){let e="",t=(r,i)=>i&&r.repeat(i)||"",n=r=>t("    ",r);return{header(r,i,o){e+=`

${n(o)}${t("#",i)} ${r}`},list(r,i){e+=`
${n(i)}${i%2?"*":"-"} ${r}`},line(r,i){e+=`
${n(i)}${r}`},newline(){e+=`
`},paragraph(r,i){this.newline(),this.line(r,i)},hr(){this.line("---")},link(r,i){return`[${r}](${i})`},bold(r){return`**${r}**`},italic(r){return`*${r}*`},code(r){return`\`${r}\``},render(){return e.replace(/^\s+|\s+$/g,"")}}}var y=console.log;function dr(e){if(e.showTitle&&(y(c.bold(e.title)),y()),e.onlyVersion){let t=e.history[e.onlyVersion];e.history={},t&&(e.history[e.onlyVersion]=t)}for(let t in e.history){if(!e.showUnreleased&&t=="unreleased")continue;let n=e.history[t];!e.onlyVersion&&y(`${c.yellow(t)}${n.date?c.gray(" - "+K(n.date,e.dateFormat)):""}`);for(let r of e.showTypes)if(n.commits[r]){y(" ",`${c.bold(c.green(W(r)))}:`);for(let i of n.commits[r]){let o=i.namespace?c.bold(i.namespace+": "):"",u=C(ee(i.subject)),a=i.body&&c.gray(C(ee(i.body))),p=i.issues&&i.issues.length&&` (${i.issues.map(l=>c.link("#"+l,X(e.repo,l))).join(", ")})`,m=c.blue(c.link(i.hash.substring(0,8),Z(e.repo,i.hash)));y("  ",c.green("*"),`${o}${u}${p||""} ${m}`),e.showBody&&a&&y("    ",a)}}}}function fr(e){let t=cr();if(e.showTitle&&t.header(e.title,1,0),e.onlyVersion){let n=e.history[e.onlyVersion];e.history={},n&&(e.history[e.onlyVersion]=n)}for(let n in e.history){if(!e.showUnreleased&&n=="unreleased")continue;let r=e.history[n];!e.onlyVersion&&t.header(`${n}${r.date?" - "+K(r.date,e.dateFormat):""}`,2,0);for(let i of e.showTypes)if(r.commits[i]){t.header(W(i),3,0),t.newline();for(let o of r.commits[i]){let u=o.namespace?t.bold(o.namespace+":")+" ":"",a=C(te(o.subject,t)),p=o.body&&C(te(o.body,t)),m=o.issues&&o.issues.length&&` (${o.issues.map(g=>t.link("#"+g,X(e.repo,g))).join(", ")})`,l=t.link(t.code(o.hash.substring(0,8)),Z(e.repo,o.hash));t.list(`${u}${a}${m||""} ${l}`,0),e.showBody&&p&&t.line(p,0)}}}return t.render()}function ee(e){return e.replace(/https?:\/\/.+?\/(?:issues|pull|merge_requests|pull_requests)\/(\d+)(?:\/\S*)?/gi,(t,n)=>c.link("#"+n,t))}function te(e,t){return e.replace(/https?:\/\/.+?\/(?:issues|pull|merge_requests|pull_requests)\/(\d+)(?:\/\S*)?/gi,(n,r)=>t.link("#"+r,n))}var J={output:"cli",showTypes:["feat","fix","perf","docs","other"],title:"Changelog",dateFormat:"%Y-%M-%D",showUnreleased:!0,showBody:!0,showTitle:!0,onlyVersion:null};function Ye(e){if(e={...J,...e||{},history:We(!0),repo:Ze()},!e.output||e.output=="markdown")return fr(e);e.output=="cli"&&dr(e)}});var d=S(Y()),k=S(re()),ne=S(require("fs"));try{let e={title:d.default.getInput("title"),list:d.default.getInput("list"),date:d.default.getInput("date"),file:d.default.getInput("file"),version:d.default.getInput("version"),unreleased:d.default.getInput("unreleased"),hideUnreleased:d.default.getInput("hide-unreleased"),hideTitle:d.default.getInput("hide-title"),hideBody:d.default.getInput("hide-body"),output:"cli"};console.log("Rendering markdown..."),(0,k.render)(ie(e)),e.output="markdown";let t=(0,k.render)(ie(e));d.default.setOutput("changelog",t),console.log("Saving to "+e.file),ne.default.writeFileSync(e.file,t)}catch(e){d.default.setFailed(e.message)}function ie(e){return{title:e.title,output:e.output||"cli",showTypes:e.list.split(","),dateFormat:e.date,showUnreleased:e.hideUnreleased=="false",showBody:e.hideTitle=="false",showTitle:e.hideBody=="false",onlyVersion:!!e.version!="false"&&e.version||e.unreleased!="false"&&"unreleased"}}
